{% if termino_busqueda %}
{% if total_productos > 0 %}
<h3>Resultados para "{{termino_busqueda}}" ({{total_productos}} productos encontrados)</h3>
{% else %}
<div class="no-results">
    <h3>No se encontraron productos para "{{termino_busqueda}}"</h3>
    <p>Intenta con otros t√©rminos de b√∫squeda</p>
</div>
{% endif %}
{% endif %}

{% if total_productos > 0 %}

{% if padre %}
    <button class="back-btn"
        hx-get="/api/v2/categorias/{{ padre }}/productos" hx-disabled-elt="this"
        hx-target="#reemplazar">
        &larr; Atras
    </button>
{% endif %}

    <div class="container_productos">
        {% for producto in productos %}
        <div class="card">
            <img src="{{producto['imagen_url']}}" alt="{{producto['nombre']}}" class="product-image-clickable"
                hx-get="/api/v2/categorias/productos/{{producto['id']}}/detalle" hx-target="#reemplazar"
                hx-swap="innerHTML">
            <span class="precio">$ {{producto["precio"]}}</span>
            <span class="nombre">{{producto["nombre"]}}</span>
            <div class="quantity-control">
                <button id="addButton_{{producto['id']}}" class="add-button" data-product-id="{{producto['id']}}"
                    data-product-name="{{producto['nombre']}}" data-product-price="{{producto['precio']}}"
                    data-product-image-url="{{producto['imagen_url']}}">
                    Comprar
                </button>

                <div id="quantitySelector_{{producto['id']}}" class="quantity-selector hidden">
                    <button id="decreaseBtn_{{producto['id']}}" class="quantity-btn decrease-btn"
                        data-product-id="{{producto['id']}}">
                        -
                    </button>
                    <span id="quantityDisplay_{{producto['id']}}" class="quantity-display">1</span>
                    <button id="increaseBtn_{{producto['id']}}" class="quantity-btn increase-btn"
                        data-product-id="{{producto['id']}}">
                        +
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}



    {% if categorias_hijas %}
    <!-- Bot√≥n para mostrar subcategor√≠as (solo visible en m√≥viles) -->
    <button class="subcategories-toggle" onclick="toggleSubcategories()">
        <span class="toggle-icon">üìÇ</span>
        <span class="toggle-text">Ver Subcategor√≠as</span>
        <span class="toggle-count">({{ categorias_hijas|length }})</span>
    </button>

    <!-- Overlay para cerrar en m√≥viles -->
    <div class="subcategories-overlay" onclick="toggleSubcategories()"></div>
    
    <!-- Aside con subcategor√≠as -->
    <aside class="subcategories-aside" id="subcategoriesAside">
        <div class="aside-header">
            <h3>Subcategor√≠as</h3>
            <button class="close-aside" onclick="toggleSubcategories()">&times;</button>
        </div>
        <ul class="categorias">
            {% for categoria in categorias_hijas %}
                <li>
                    <form hx-post="/api/v2/categorias/{{ categoria["id"]}}/productos" hx-target="#reemplazar" onsubmit="closeSubcategories()">
                        <input type="hidden" name="padre" value="{{ categoria_padre_id }}">
                        <button type="submit" class="subcategory-btn">
                            <span class="subcategory-icon">üìÅ</span>
                            {{ categoria["nombre"] }}
                        </button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    </aside>
    {% endif %}