<div id="carrito-content">
<div class="carrito-container">
    <h2>Mi Carrito de Compras</h2>
    
    {% if is_empty %}
        <div class="cart-items">
            <div class="empty-cart">Tu carrito está vacío</div>
        </div>
    {% else %}
        <form id="cart-form" 
              action="/api/v2/categorias/carrito/checkout" 
              method="post">
            <div id="cart-items" class="cart-items">
                {% for item in cart_items %}
                <div class="cart-item">
                    <!-- Campos hidden para datos del producto -->
                    <input type="hidden" name="items[{{ loop.index0 }}][id]" value="{{ item.id }}">
                    <input type="hidden" name="items[{{ loop.index0 }}][name]" value="{{ item.name }}">
                    <input type="hidden" name="items[{{ loop.index0 }}][price]" value="{{ item.price }}">
                    
                    <div class="cart-item-image">
                        {% if item.imageUrl and item.imageUrl != '/static/default-product.png' %}
                            <img src="{{ item.imageUrl }}" alt="{{ item.name }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="default-image" style="display: none;">📦</div>
                        {% else %}
                            <div class="default-image">📦</div>
                        {% endif %}
                    </div>
                    <div class="cart-item-info">
                        <div class="cart-item-name">{{ item.name }}</div>
                        <div class="cart-item-details">${{ "%.2f"|format(item.price) }} c/u</div>
                    </div>
                    <div class="cart-item-controls">
                        <div class="quantity-controls">
                            <button type="button" class="quantity-btn decrease-btn" 
                                    hx-post="/api/v2/categorias/carrito/decrease/{{ item.id }}"
                                    hx-target="#reemplazar">-</button>
                            <input type="number" 
                                   name="items[{{ loop.index0 }}][quantity]" 
                                   value="{{ item.quantity }}" 
                                   min="1" 
                                   max="{{ item.stock_actual if item.stock_actual else 99 }}"
                                   class="quantity-display"
                                   hx-post="/api/v2/categorias/carrito/update/{{ item.id }}"
                                   hx-target="#reemplazar"
                                   hx-trigger="change">
                            <button type="button" class="quantity-btn increase-btn"
                                    hx-post="/api/v2/categorias/carrito/increase/{{ item.id }}"
                                    hx-target="#reemplazar">+</button>
                        </div>
                        <button type="button" class="remove-btn" 
                                hx-post="/api/v2/categorias/carrito/remove/{{ item.id }}"
                                hx-target="#reemplazar"
                                hx-confirm="¿Eliminar {{ item.name }} del carrito?">
                            Eliminar
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </form>
    {% endif %}
    
    <div class="cart-total-section">
        <div class="cart-total">
            <strong>Total: $</strong><span id="cart-total">{{ "%.2f"|format(total) }}</span>
        </div>
        
        {% if not is_empty %}
            <button type="submit" form="cart-form" class="checkout-btn"> 
                Finalizar Compra
            </button>
        {% else %}
            <button class="checkout-btn" disabled>Finalizar Compra</button>
        {% endif %}
    </div>
    
    {% if error %}
    <div class="error-message">{{ error }}</div>
    {% endif %}
</div>
</div>

<!-- Script simple para el carrito -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Template de carrito cargado');
    
    // Solo mantener funcionalidad básica del carrito
    const cartForm = document.getElementById('cart-form');
    if (cartForm) {
        cartForm.addEventListener('submit', function(event) {
            console.log('Enviando formulario del carrito...');
            // El formulario se enviará normalmente y redirigirá a la página de éxito
        });
    }
});
</script>